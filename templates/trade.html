<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade - Tesla Finance</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:#f4f6f9;}

/* ================= NAVBAR ================= */
.navbar{
    height:70px;background:#fff;display:flex;
    align-items:center;justify-content:space-between;
    padding:0 25px;box-shadow:0 2px 8px rgba(0,0,0,0.05);
    position:fixed;width:100%;top:0;z-index:1000;
}
.nav-left{display:flex;align-items:center;gap:15px;}
.nav-left img{width:170px;}
.user-email{background:#f1f3f7;padding:8px 15px;border-radius:6px;font-size:14px;color:#555;}
.menu-btn{font-size:26px;cursor:pointer;}

/* ================= SIDEBAR ================= */
.sidebar{
    position:fixed;left:-260px;top:0;width:260px;height:100%;
    background:#fff;box-shadow:2px 0 12px rgba(0,0,0,0.08);
    padding:20px;transition:0.3s;z-index:2000;
}
.sidebar.active{left:0;}
.sidebar img{width:160px;margin-bottom:30px;}
.sidebar a{
    display:flex;align-items:center;gap:12px;
    padding:14px;margin-bottom:10px;border-radius:10px;
    text-decoration:none;color:#666;font-size:15px;transition:0.3s;
}
.sidebar a:hover{background:#f2f2f2;}
.sidebar a.active{background:#ff0033;color:#fff;}

/* ================= CONTENT ================= */
.content{padding:110px 30px 40px 30px;}
.trade-box{
    background:#fff;padding:30px;border-radius:14px;
    box-shadow:0 5px 15px rgba(0,0,0,0.04);
}
.trade-box h2{font-size:20px;font-weight:600;margin-bottom:20px;}
.invest-btn{
    margin-top:25px;
    background:#ff0033;
    padding:12px 25px;
    border-radius:8px;
    color:#fff;
    font-weight:500;
    transition:0.3s;
}
.invest-btn:hover{
    background:#cc0029;
}
@media(max-width:768px){
    .nav-left img{width:130px;}
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <img src="static/images/dark_logo.png">
    <a href="/dashboard">üè† Dashboard</a>
    <a href="#">üìä All signal</a>
    <a href="/trade.html" class="active">üìà Trade</a>
    <a href="/plan.html">üíº Invest</a>
    <a href="/deposit.html">üí≥ Deposit now</a>
    <a href="/withdraw.html">üíµ Withdraw</a>
    <a href="#">üìë Report</a>
    <a href="/profile.html">üë§ Profile</a>
</div>

<!-- Navbar -->
<div class="navbar">
    <div class="nav-left">
        <img src="static/images/dark_logo.png">
        <div class="user-email" id="email"></div>
    </div>
    <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
</div>

<!-- Content -->
<div class="content">

    <div class="trade-box">
        <h2>Live Market Trade</h2>

        <!-- TradingView Widget -->
        <div id="tradingview_chart"></div>

        <button class="invest-btn" onclick="goToPlan()">
            Invest Now
        </button>
    </div>

</div>

<script src="https://s3.tradingview.com/tv.js"></script>

<script>
function toggleMenu(){
    document.getElementById("sidebar").classList.toggle("active");
}

// Load current user
document.addEventListener("DOMContentLoaded", async ()=>{
    try{
        const res = await fetch("/api/current_user",{method:"GET",credentials:"include"});
        if(!res.ok){window.location.href="/login.html";return;}
        const data = await res.json();
        const emailShort = data.email.length>7?data.email.substring(0,7)+"...":data.email;
        document.getElementById("email").innerText = emailShort;
    }catch(e){
        console.error(e);
        window.location.href="/login.html";
    }

    // Load TradingView
    new TradingView.widget({
        "width": "100%",
        "height": 500,
        "symbol": "BINANCE:BTCUSDT",
        "interval": "30",
        "timezone": "Etc/UTC",
        "theme": "light",
        "style": "1",
        "locale": "en",
        "toolbar_bg": "#f4f6f9",
        "enable_publishing": false,
        "allow_symbol_change": true,
        "container_id": "tradingview_chart"
    });
});

function goToPlan(){
    window.location.href="/plan.html";
}
</script>

</body>
</html>